

@model Tratament.Web.ViewModels.SendRequest.SendRequestViewModel

@using Microsoft.Extensions.Options
@using DNTCaptcha.Core

@inject IOptions<DNTCaptchaOptions> Options
@{
    ViewBag.Title = "Login";
    var refreshButtonId = Options.Value.CaptchaClass + "RefreshButton";
}


<div class="container">

    <div class="row mt-3">
        <div class="col-sm-12">
            <h5> Depune cererea </h5>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" asp-controller="SendRequest" asp-action="Send" id="sendRequestForm"
          
          data-ajax="true"
                  data-ajax-success="dataAjaxSuccess"
          
          
          >

        <div class="mt-5">

            <div class="row">

                <div class="col-sm-5">

                    <div class="row mt-2">
                        <label class="col-sm-4">Tipul pensiei</label>
                        <div class="col-sm-8">

                            <select asp-for="@(Model.TicketTypeId)" asp-items="@(ViewBag.TicketTypes)" class="form-control" id="tiketType" onchange="GetPensionTypeSelectedItem()">
                                <option selected value="">Alege Tipul tichetului</option>
                            </select>
                            <span asp-validation-for="@(Model.TicketTypeId)" class="text-danger"></span>

                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">IDNP benficiarului</label>
                        <div class="col-sm-8">

                            <input type="text" asp-for="@(Model.Idnp)" class="form-control" id="Idnp" />
                            <span asp-validation-for="@(Model.Idnp)" class="text-danger"></span>

                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">Email</label>
                        <div class="col-sm-8">

                            <input type="text" asp-for="@(Model.Email)" class="form-control" id="email" />
                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">Phone</label>
                        <div class="col-sm-8">
                            <input type="text" asp-for="@(Model.Phone)" class="form-control" id="phone" />
                        </div>
                    </div>

                    <hr />

                    <div class="row" id="error-corect-data" style="display:none">
                        <div class="col-sm-10">
                            <span id="error-corect-data" style="color: red;">Acest cimp este obligator</span>
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-sm-1" style="display:none" id="ConfirmCorectData">
                            <input id="CorrectData" type="checkbox" name="CorrectData" data-val="true">
                        </div>

                        <div class="col-sm-11">

                            <div id="DisabilitiesTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/DisabilitiesTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="VeteransTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/VeteransTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="CernobilTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/CernobilTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="PaymentCompensationConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/PaymentCompensationConfirm_Partial.cshtml")
                            </div>

                        </div>
                    </div>



                    <div class="row">
                        <div class="col-sm-12">


                            <div>
                                <dnt-captcha asp-captcha-generator-max="30"
                                             asp-captcha-generator-min="1"
                                             asp-captcha-generator-language="English"
                                             asp-captcha-generator-display-mode="ShowDigits"

                                             asp-use-relative-urls="true"
                                             asp-placeholder="Security code as a number"
                                             asp-validation-error-message="Please enter the security code as a number."
                                             asp-too-many-requests-error-message="Too many requests! Please wait a minute!"
                                             asp-font-name="Tahoma"
                                             asp-font-size="40"
                                             asp-fore-color="#333333"

                                             asp-back-color="#FCF6F5FF"
                                             asp-text-box-class="form-control"
                                             asp-text-box-template="<div class='input-group'><span class='input-group-text'><span class='bi-lock'></span></span>{0}</div>"
                                             
                                             asp-validation-message-class="text-danger"
                                             asp-refresh-button-class="bi-arrow-counterclockwise btn-lg"
                                             asp-show-refresh-button="true"
                                             asp-dir="ltr" />
                            </div>

                        </div>

                    </div>





                    <div class="row mt-2">
                        <div class="col-sm-12">
                            <button type="submit" class="btn btn-primary">Aplicat</button>
                        </div>

                    </div>

                </div>

                <div class="col-sm-7">

                    <div id="DisabilitiesTreatmentTickets" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/DisabilitiesTreatmentTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="VeteransTreatmentTickets" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/VeteransTreatmentTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="TicketsForCernobil" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/RequestCernobilTreatmentsTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="PaymentCompensation" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/PaymentCompensationForCernobil.cshtml")
                    </div>

                </div>

            </div>

        </div>

    </form>

</div>



<script type="text/javascript">

    function GetPensionTypeSelectedItem() {

        var utilDivIds = [
            "DisabilitiesTreatmentTickets",
            "VeteransTreatmentTickets",
            "TicketsForCernobil",
            "PaymentCompensation"
        ];


        var confirmDivsId = [
            "ConfirmCorectData",
            "DisabilitiesTicketsConfirm",
            "VeteransTicketsConfirm",
            "CernobilTicketsConfirm",
            "PaymentCompensationConfirm"
        ];

        var value = document.getElementById("tiketType");
        var getvalue = value.options[value.selectedIndex].value;

        HideMultipleDivs(utilDivIds);

        HideMultipleDivs(confirmDivsId);

        switch (getvalue) {
            case "1":
                ShowUtilDivs(document.getElementById("DisabilitiesTreatmentTickets"));

                ShowUtilDivs(document.getElementById("DisabilitiesTicketsConfirm"));
                ShowUtilDivs(document.getElementById("ConfirmCorectData"));
                break;

            case "2":
                ShowUtilDivs(document.getElementById("VeteransTreatmentTickets"));

                ShowUtilDivs(document.getElementById("DisabilitiesTicketsConfirm"));
                ShowUtilDivs(document.getElementById("ConfirmCorectData"));
                break;

            case "3":
                ShowUtilDivs(document.getElementById("TicketsForCernobil"));

                ShowUtilDivs(document.getElementById("CernobilTicketsConfirm"));
                ShowUtilDivs(document.getElementById("ConfirmCorectData"));

                break;

            case "4":
                ShowUtilDivs(document.getElementById("PaymentCompensation"));

                ShowUtilDivs(document.getElementById("PaymentCompensationConfirm"));
                ShowUtilDivs(document.getElementById("ConfirmCorectData"));

                break;

            default:
                // If no valid selection, keep all divs hidden
                break;
        }
    }

    function HideUtilDivs(divElement) {

        if (IsVisible(divElement)) {
            divElement.style.display = 'none';
        }
    }

    function ShowUtilDivs(divId) {
        divId.style.display = 'block';
    }

    function HideMultipleDivs(divIds) {

        divIds.forEach(function (divId) {
            var divElement = document.getElementById(divId);
            if (divElement) {
                HideUtilDivs(divElement);
            }
        });
    }

    document.getElementById('sendRequestForm').addEventListener('submit', function (event) {

        debugger;

        var correctData = document.getElementById('CorrectData');

        if (IsVisible(correctData)) {
            ValidateCorrectData(event);
        }
    });

    function ValidateCorrectData(event) {

        var correctData = document.getElementById('CorrectData');
        var errorCorrectData = document.getElementById('error-corect-data');

        if (!correctData.checked) {

            PreventSubmit(event);
            errorCorrectData.style.display = 'block';

        } else {
            errorCorrectData.style.display = 'none';
        }
    }

    function PreventSubmit(event) {
        event.preventDefault();
    }

    function IsVisible(divElement) {

        if ($(divElement).is(':visible')) {
            return true;
        }
        return false;
    }

    const checkbox = document.querySelector('#CorrectData');

    const divElement = document.querySelector('#error-corect-data');

    checkbox.addEventListener('change', handleChange);

    function handleChange(e) {
        if (e.target.checked && IsVisible(checkbox)) {
            $(divElement).hide();
        }
    }


     function dataAjaxSuccess(data, status, xhr) {
        alert('Success!');
         $("#sendRequestForm #@refreshButtonId").click(); // refresh captcha
    }

</script>



