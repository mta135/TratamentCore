

@model Tratament.Web.ViewModels.SendRequest.SendRequestViewModel

@using Microsoft.Extensions.Options

@{
    ViewBag.Title = "Send Request";
}

<div class="container">

    <div class="row mt-3">
        <div class="col-sm-12">
            <h5> Depune cererea </h5>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" asp-controller="SendRequest" asp-action="Send" id="sendRequestForm" >

        <div class="mt-1">

            <div class="row">

                <div class="col-sm-5">

                    <div class="row mt-2">
                        <label class="col-sm-4">Tipul pensiei</label>
                        <div class="col-sm-8">

                            <select asp-for="@(Model.TicketTypeId)" asp-items="@(ViewBag.TicketTypes)" class="form-control shadow-none" id="tiketType">
                                <option selected value="">Alege Tipul tichetului</option>
                            </select>
                            <span asp-validation-for="@(Model.TicketTypeId)" class="text-danger"></span>

                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">IDNP benficiarului</label>
                        <div class="col-sm-8">

                            <input type="text" asp-for="@(Model.Idnp)" class="form-control shadow-none" id="Idnp" />
                            <span asp-validation-for="@(Model.Idnp)" class="text-danger"></span>

                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">Email</label>
                        <div class="col-sm-8">

                            <input type="text" asp-for="@(Model.Email)" class="form-control shadow-none" id="email" />
                        </div>
                    </div>

                    <div class="row mt-2">
                        <label class="col-sm-4">Phone</label>
                        <div class="col-sm-8">
                            <input type="text" asp-for="@(Model.Phone)" class="form-control shadow-none" id="phone" />
                        </div>
                    </div>

                    <hr />

                    <div class="row" id="error-corect-data" style="display:none">
                        <div class="col-sm-10">
                            <span id="error-corect-data" style="color: red;">Acest cimp este obligator</span>
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-sm-1" style="display:none" id="ConfirmCorectData">
                            <input id="CorrectData" type="checkbox" name="CorrectData" data-val="true">
                        </div>

                        <div class="col-sm-11">

                            <div id="DisabilitiesTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/DisabilitiesTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="VeteransTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/VeteransTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="CernobilTicketsConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/CernobilTicketsConfirm_Partial.cshtml")
                            </div>

                            <div id="PaymentCompensationConfirm" style="display:none">
                                @await Html.PartialAsync("~/Views/Partials/PaymentCompensationConfirm_Partial.cshtml")
                            </div>

                        </div>
                    </div>


                    <div class="row">
                        <div class="col-sm-12">
                            @await Html.PartialAsync("~/Views/Partials/DntCaptcha_Partial.cshtml")
                        </div>
                    </div>

                    @*<div class="row">
            <div class="col-sm-12">
                @await Html.PartialAsync("~/Views/Partials/Recaptcha_Partial.cshtml")
            </div>
        </div>*@

                    <div class="row mt-2">
                        <div class="col-sm-12">
                            <button type="submit" class="btn btn-primary">Aplicat</button>
                        </div>
                    </div>

                </div>

                <div class="col-sm-7">

                    <div id="DisabilitiesTreatmentTickets" style="display:none">
                        @await Html.PartialAsync("~/Views/Partials/DisabilitiesTreatmentTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="VeteransTreatmentTickets" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/VeteransTreatmentTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="TicketsForCernobil" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/RequestCernobilTreatmentsTicketsUtil_Partial.cshtml")
                    </div>

                    <div id="PaymentCompensation" style="display:none">

                        @await Html.PartialAsync("~/Views/Partials/PaymentCompensationForCernobil.cshtml")
                    </div>

                </div>

            </div>

        </div>

    </form>

</div>



<script type="text/javascript">

    const sections = {
        "1": ["DisabilitiesTreatmentTickets", "DisabilitiesTicketsConfirm"],
        "2": ["VeteransTreatmentTickets", "DisabilitiesTicketsConfirm"],
        "3": ["TicketsForCernobil", "CernobilTicketsConfirm"],
        "4": ["PaymentCompensation", "PaymentCompensationConfirm"]
    };

    const errorCorrectData = document.getElementById("error-corect-data");
    const correctDataCheckbox = document.getElementById("CorrectData");

    const sendRequestForm = document.getElementById("sendRequestForm");
    const ticketTypeDropdown = document.getElementById("tiketType");

    function toggleVisibility(ids, show) {
        ids.forEach(id => {

            const element = document.getElementById(id);
            if (element) element.style.display = show ? "block" : "none";
        });
    }

    function updateDivVisibility() {

        toggleVisibility(Object.values(sections).flat(), false);

        const selectedIds = sections[ticketTypeDropdown.value] || [];
        toggleVisibility([...selectedIds, "ConfirmCorectData"], true);
    }

    function validateCorrectData(event) {

        if (!correctDataCheckbox.checked) {

            event.preventDefault();
            errorCorrectData.style.display = "block";

        } else {
            errorCorrectData.style.display = "none";
        }
    }

    sendRequestForm.addEventListener("submit", validateCorrectData);

    correctDataCheckbox.addEventListener("change", () => errorCorrectData.style.display = "none");
    ticketTypeDropdown.addEventListener("change", updateDivVisibility);

    document.getElementById("DNTCaptchaInputText").addEventListener("input", function () {

        if (this.value.length > 6) {
            this.value = this.value.substring(0, 6); 
        }

        var span = document.querySelector('span[data-valmsg-for="DNTCaptchaInputText"]');

        if (span) {
            span.style.display = this.value.trim() ? 'none' : 'inline'; // Hide if input has value, show if empty
        }

    });

    window.addEventListener("load", function () {
        console.log("Window load event; Selected Item Id: " + ticketTypeDropdown.value);
        updateDivVisibility();
    });



</script>



